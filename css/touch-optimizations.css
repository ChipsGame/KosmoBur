/* ===== ОПТИМИЗАЦИИ ДЛЯ ТАЧ-УСТРОЙСТВ ===== */

/* 1. Оптимизация для быстрого отклика на тапы */
button, .menu-btn, .close-modal, .upgrade-card, .modal-content {
    touch-action: manipulation !important;
    -webkit-tap-highlight-color: rgba(0,0,0,0) !important;
    -webkit-tap-highlight-color: transparent !important;
    cursor: pointer;
}

/* 2. Минимальные размеры для удобного тапа (Apple Human Interface Guidelines) */
.menu-btn {
    min-width: 44px !important;
    min-height: 44px !important;
}

button:not(.menu-btn) {
    min-height: 44px !important;
    padding: 12px 20px !important;
}

/* 3. Улучшение отзывчивости UI элементов */
.menu-btn:active, button:active, .upgrade-card:active {
    transform: scale(0.95) !important;
    transition: transform 0.1s !important;
}

/* 4. Оптимизация скролла в модальных окнах */
.modal-content {
    -webkit-overflow-scrolling: touch !important;
    overflow-y: auto !important;
    overscroll-behavior: contain !important;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
}

.modal-content::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
}

/* 5. Предотвращение выделения текста при долгом тапе */
* {
    -webkit-user-select: none !important;
    -moz-user-select: none !important;
    -ms-user-select: none !important;
    user-select: none !important;
    -webkit-touch-callout: none !important;
}

/* Разрешаем выделение в полях ввода (если они есть) */
input, textarea {
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    -ms-user-select: text !important;
    user-select: text !important;
}

/* 6. Оптимизация анимаций для мобильных */
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* 7. Адаптация для разных размеров экранов */

/* Очень маленькие экраны (менее 320px) */
@media screen and (max-width: 319px) {
    #top-bar {
        flex-wrap: wrap;
        gap: 5px;
    }
    
    .resources-left {
        order: 1;
        width: 100%;
        justify-content: center;
    }
    
    #top-menu {
        order: 2;
        width: 100%;
        justify-content: center;
    }
    
    .modal {
        padding: 5px !important;
    }
    
    .modal-content {
        padding: 15px 10px !important;
    }
}

/* Маленькие экраны (320px - 480px) */
@media screen and (min-width: 320px) and (max-width: 480px) {
    .upgrades-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
        gap: 8px !important;
    }
    
    .upgrade-card {
        padding: 10px !important;
    }
    
    .upgrade-name {
        font-size: 14px !important;
    }
    
    .upgrade-price {
        font-size: 12px !important;
    }
}

/* Средние экраны (481px - 768px) */
@media screen and (min-width: 481px) and (max-width: 768px) {
    .upgrades-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) !important;
    }
}

/* 8. Оптимизация для ландшафтной ориентации */
@media screen and (orientation: landscape) and (max-height: 500px) {
    #top-bar {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 1000 !important;
        background: rgba(0,0,0,0.9) !important;
    }
    
    #status-panel {
        top: 50px !important;
    }
    
    #pause-panel {
        top: 80px !important;
    }
    
    .modal {
        padding-top: 60px !important;
    }
}

/* 9. Оптимизация для устройств с вырезом (notch) */
@supports (padding: max(0px)) {
    #top-bar {
        padding-left: max(8px, env(safe-area-inset-left)) !important;
        padding-right: max(8px, env(safe-area-inset-right)) !important;
        padding-top: max(8px, env(safe-area-inset-top)) !important;
    }
    
    .modal-content {
        padding-left: max(20px, env(safe-area-inset-left)) !important;
        padding-right: max(20px, env(safe-area-inset-right)) !important;
        padding-bottom: max(20px, env(safe-area-inset-bottom)) !important;
    }
}

/* 10. Улучшение читаемости на ярком свету */
@media screen and (prefers-color-scheme: light) {
    .modal-content {
        background: rgba(255, 255, 255, 0.95) !important;
        color: #000 !important;
    }
    
    .modal-content h2 {
        color: #000 !important;
    }
}

/* 11. Оптимизация для медленных устройств */
@media (prefers-reduced-data: reduce) {
    * {
        background-image: none !important;
    }
    
    .stars-bg, .stars-bg-2, .stars-twinkle, .planet-bg, .planet-bg-2, .meteor {
        display: none !important;
    }
}

/* 12. Фикс для виртуальной клавиатуры */
.modal:has(input:focus), .modal:has(textarea:focus) {
    position: fixed !important;
    top: 0 !important;
    height: 100vh !important;
}

/* 13. Улучшение accessibility для людей с ограниченными возможностями */
@media (prefers-reduced-motion: reduce) {
    .menu-btn.ad-btn {
        animation: none !important;
    }
    
    .tap-boost-badge {
        animation: none !important;
    }
}

/* 14. Оптимизация для темной темы (экономия батареи на OLED) */
@media (prefers-color-scheme: dark) {
    #game-container {
        background: #000 !important;
    }
    
    .modal-content {
        background: rgba(20, 20, 30, 0.98) !important;
    }
}

/* 15. Фикс для очень высоких экранов (современные смартфоны) */
@media screen and (min-height: 800px) and (max-width: 500px) {
    .modal-content {
        max-height: 80vh !important;
    }
    
    .upgrades-grid {
        max-height: 60vh !important;
        overflow-y: auto !important;
    }
}

/* ===== ОПТИМИЗАЦИЯ БОССА ДЛЯ МОБИЛЬНЫХ ===== */

/* Увеличиваем область тапа для боя с боссом */
@media screen and (max-width: 768px) {
    /* Увеличиваем UI босса */
    #boss-ui {
        width: 90vw !important;
        max-width: 350px !important;
        bottom: 30px !important;
    }
    
    .boss-bars-container {
        gap: 12px !important;
    }
    
    .boss-bar-wrapper {
        padding: 12px 15px !important;
    }
    
    .boss-bar {
        height: 20px !important;
    }
    
    .boss-bar-label {
        font-size: 12px !important;
    }
    
    .boss-bar-text {
        font-size: 14px !important;
    }
    
    /* Увеличиваем кнопки в модалках босса */
    .boss-start-btn,
    .boss-continue-btn,
    .boss-ad-btn,
    .boss-skip-btn {
        min-height: 50px !important;
        font-size: 16px !important;
    }
    
    /* Улучшаем читаемость текста */
    .boss-info p {
        font-size: 14px !important;
    }
    
    .boss-value {
        font-size: 28px !important;
    }
    
    /* Увеличиваем иконки */
    .boss-victory-modal .boss-icon,
    .boss-defeat-modal .boss-icon {
        font-size: 72px !important;
    }
    
    /* Баффы больше и заметнее */
    .boss-buff {
        font-size: 14px !important;
        padding: 8px 15px !important;
    }
    
    /* Модалки босса адаптивнее */
    .boss-modal,
    .boss-victory-modal,
    .boss-defeat-modal {
        width: 90vw !important;
        max-width: 380px !important;
    }
}

/* Для очень маленьких экранов */
@media screen and (max-width: 380px) {
    #boss-ui {
        width: 95vw !important;
        bottom: 20px !important;
    }
    
    .boss-bar-wrapper {
        padding: 10px 12px !important;
    }
    
    .boss-bar {
        height: 18px !important;
    }
    
    .boss-modal h2,
    .boss-victory-modal h2,
    .boss-defeat-modal h2 {
        font-size: 22px !important;
    }
}

/* Для ландшафтной ориентации во время боя с боссом */
@media screen and (orientation: landscape) and (max-height: 500px) {
    #boss-ui {
        bottom: 10px !important;
        width: 70vw !important;
    }
    
    .boss-bars-container {
        flex-direction: row !important;
        gap: 10px !important;
    }
    
    .boss-bar-wrapper {
        flex: 1;
    }
}

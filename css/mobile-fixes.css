/* ===== ФИКСЫ ДЛЯ МОБИЛЬНЫХ УСТРОЙСТВ (iOS/Android) ===== */

/* КРИТИЧНО: Фиксы для предотвращения раздвоения Canvas на iOS */
@media screen and (max-width: 768px) {
    /* Отключаем все анимации фона на iOS для стабильности */
    .stars-bg, .stars-bg-2, .stars-twinkle, .planet-bg, .planet-bg-2, .meteor {
        animation: none !important;
        display: none !important;
    }
    
    /* Упрощаем фон для мобильных */
    #game-container {
        background: linear-gradient(180deg, #0a0a1a 0%, #1a1a3a 50%, #0d1b2a 100%) !important;
    }
    
    /* Фикс для Canvas на iOS */
    #gameCanvas {
        /* Убираем все трансформации */
        transform: none !important;
        -webkit-transform: none !important;
        /* Фиксируем позиционирование */
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        /* Убираем все отступы и границы */
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        /* Предотвращаем сглаживание */
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        /* Стандартные свойства для 3D трансформаций */
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        perspective: 1000px;
        -webkit-perspective: 1000px;
        transform-style: flat;
        -webkit-transform-style: flat;
        /* Убираем тени и эффекты */
        box-shadow: none !important;
        filter: none !important;
    }
    
    /* Фикс для предотвращения pull-to-refresh на iOS */
    body {
        overscroll-behavior: none;
        -webkit-overflow-scrolling: touch;
        position: fixed;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    
    /* Фикс для кнопок на iOS */
    button, .menu-btn, .close-modal {
        -webkit-appearance: none;
        appearance: none;
        border-radius: 8px;
        min-height: 44px; /* Минимальная высота для удобного тапа */
        min-width: 44px; /* Минимальная ширина для удобного тапа */
    }
    
    /* Фикс для предотвращения масштабирования при двойном тапе */
    * {
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
        text-size-adjust: 100%;
    }
}

/* Фиксы для очень маленьких экранов */
@media screen and (max-height: 600px) {
    #top-bar {
        padding: 4px 8px !important;
        min-height: 36px !important;
    }
    
    .menu-btn {
        width: 32px !important;
        height: 32px !important;
        font-size: 14px !important;
    }
    
    .resource {
        font-size: 12px !important;
    }
    
    #depth-meter {
        font-size: 13px !important;
    }
}

/* Фиксы для очень узких экранов */
@media screen and (max-width: 360px) {
    .resources-left {
        gap: 6px !important;
    }
    
    #top-menu {
        gap: 4px !important;
    }
    
    .modal-content {
        padding: 15px !important;
        width: 95% !important;
    }
    
    .upgrades-grid {
        grid-template-columns: 1fr !important;
    }
}

/* Фикс для предотвращения мерцания на Android */
@media screen and (-webkit-min-device-pixel-ratio: 0) {
    #gameCanvas {
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        perspective: 1000px;
        -webkit-perspective: 1000px;
    }
}

/* Фикс для Safari на iOS */
@supports (-webkit-touch-callout: none) {
    /* Отключаем все сложные фоны и анимации */
    #game-container {
        background: #0a0a1a !important;
    }
    
    /* Упрощаем UI для лучшей производительности */
    #ui-layer {
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
    }
    
    /* Фикс для скролла в модалках */
    .modal-content {
        -webkit-overflow-scrolling: touch !important;
        overflow-y: auto !important;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
    }
}

/* Фикс для устройств с высоким DPI */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    #gameCanvas {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
    }
}